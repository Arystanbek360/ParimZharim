## Обновление заказа и добавление позиций через API

### Описание

**Цель**: Тестирование API для обновления заказа и добавления новых позиций к существующему заказу, включая продукты и дополнительные услуги.

Проверка правильности обработки запроса, включая авторизацию, валидацию данных и корректное обновление заказа в базе данных.

### Предусловия и необходимые инструменты

- Авторизованный клиент с профилем и активными заказами.
- Доступ к API по адресу `/api/order/add-order-items`.
- Токен авторизованного клиента.

### Тестовые данные
- Токен клиента с заказами: [токен клиента с заказами].
- Существующий заказ ID, принадлежащий клиенту: 123.
- Продукты и услуги с идентификаторами и количествами.

### Позитивные кейсы

#### Шаг 1:
Отправить POST-запрос на `/api/order/add-order-items` с токеном клиента и следующим телом запроса:
```json
{
  "order_id": 123,
  "products": [
    {
      "product_id": 1,
      "product_quantity": 2
    },
    {
      "product_id": 2,
      "product_quantity": 1
    }
  ],
  "additional_services": [
    {
      "service_id": 1,
      "quantity": 1
    },
    {
      "service_id": 2,
      "quantity": 3
    }
  ]
}
```
**Ожидаемый результат**: Позиции успешно добавлены, статус-код 204.

### Негативные кейсы

#### Шаг 1:
Отправить POST-запрос на `/api/order/add-order-items` без указания `order_id`:
```json
{
  "products": [
    {
      "product_id": 1,
      "product_quantity": 2
    }
  ],
  "additional_services": [
    {
      "service_id": 1,
      "quantity": 1
    }
  ]
}
```
**Ожидаемый результат**: Возвращается статус-код 400 с сообщением об ошибке "Missing Required Fields".

#### Шаг 2:
Отправить POST-запрос на `/api/order/add-order-items` с `order_id`, который не принадлежит клиенту:
```json
{
  "order_id": 999,
  "products": [
    {
      "product_id": 1,
      "product_quantity": 2
    }
  ],
  "additional_services": [
    {
      "service_id": 1,
      "quantity": 1
    }
  ]
}
```
**Ожидаемый результат**: Возвращается статус-код 403 с сообщением об ошибке "Order does not belong to this customer".

#### Шаг 3:
Отправить POST-запрос на `/api/order/add-order-items` с `order_id`, который не существует в базе данных:
```json
{
  "order_id": 9999,
  "products": [
    {
      "product_id": 1,
      "product_quantity": 2
    }
  ],
  "additional_services": [
    {
      "service_id": 1,
      "quantity": 1
    }
  ]
}
```
**Ожидаемый результат**: Возвращается статус-код 404 с сообщением об ошибке "Order not found".

### Примеры запросов и ответов для негативных кейсов

#### Без указания order_id:
POST `/api/order/add-order-items`
Headers:
```
Authorization: Bearer [токен клиента]
```
**Ожидаемый результат**:
```json
{
    "message": "Missing required fields",
    "status_code": 400
}
```

#### Заказ не принадлежит клиенту:
POST `/api/order/add-order-items`
Headers:
```
Authorization: Bearer [токен клиента]
```
Body:
```json
{
  "order_id": 999
}
```
**Ожидаемый результат**:
```json
{
    "message": "Order does not belong to this customer",
    "status_code": 403
}
```

#### Заказ не найден:
POST `/api/order/add-order-items`
Headers:
```
Authorization: Bearer [токен клиента]
```
Body:
```json
{
  "order_id": 9999
}
```
**Ожидаемый результат**:
```json
{
    "message": "Domain Error: Не найден заказ с идентификатором 9999",
    "status_code": 404
}
```

### Постусловия

- Убедиться, что клиент может повторно авторизоваться при необходимости.
- Проверить, что данные заказа корректно обновляются в базе данных при успешном добавлении новых позиций.

### Замечания/Примечания

- Проверить корректность работы авторизации через токен.
- Убедиться, что система корректно обрабатывает запросы и возвращает соответствующие ошибки при неправильном вводе данных  или несоответствии заказа.
- Проверить, что при отсутствии `order_id` возвращается ошибка 400, и что доступ к чужим заказам блокируется с ошибкой 403.
