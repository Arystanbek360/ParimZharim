## Предрасчет цены по объекту и дате через API

### Описание

**Цель**: Тестирование API для предрасчета цены на основе выбранного объекта и даты.

Проверка корректности вычислений и авторизации клиента, а также валидации обязательных полей и обработки ошибок.

### Предусловия и необходимые инструменты

- Авторизованный клиент с доступом к API.
- Токен авторизации.

### Тестовые данные

- Токен авторизованного клиента: [токен клиента].
- Объект ID: 1 (пример существующего объекта).
- Несуществующий объект ID: 404.

### Позитивные кейсы

#### Шаг 1:
Отправка запроса от пользователя, у которого сегодня день рождения:
```json
{
  "object_id": 101,
  "date": {
    "booking_date": "2024-06-09",
    "check_in": "20:00:00",
    "hours": 4
  },
  "persons": {
    "adults": 2,
    "kids": 1
  }
}
```
**Ожидаемый результат**: Возвращается статус-код 200 и данные предрасчета с дополнительной скидкой за день рождения:
```json
{
  "total_price": 5000,
  "discount_percent": 10,
  "discount_price": 500,
  "total_price_with_discount": 4500,
  "advanced_payment": 900
}
```

#### Шаг 2:
Отправка запроса от пользователя с постоянной скидкой:
```json
{
  "object_id": 101,
  "date": {
    "booking_date": "2024-06-09",
    "check_in": "20:00:00",
    "hours": 4
  },
  "persons": {
    "adults": 2,
    "kids": 1
  }
}
```
**Ожидаемый результат**: Возвращается статус-код 200 и данные предрасчета с учетом постоянной скидки пользователя:
```json
{
  "total_price": 5000,
  "discount_percent": 7,
  "discount_price": 700,
  "total_price_with_discount": 4300,
  "advanced_payment": 1000
}
```

#### Шаг 3:
Отправка запроса от пользователя, у которого нет никаких скидок:
```json
{
  "object_id": 101,
  "date": {
    "booking_date": "2024-06-09",
    "check_in": "20:00:00",
    "hours": 4
  },
  "persons": {
    "adults": 2,
    "kids": 1
  }
}
```
**Ожидаемый результат**: Возвращается статус-код 200 и данные предрасчета без применения скидок:
```json
{
  "total_price": 5000,
  "discount_percent": 0,
  "discount_price": 0,
  "total_price_with_discount": 5000,
  "advanced_payment": 2500
}
```

### Негативные кейсы

#### Шаг 1:
Отправить POST-запрос на `/api/orders/precalculate` без обязательных полей (например, без `object_id`):
```json
{
  "date": {
    "booking_date": "2024-06-09",
    "check_in": "20:00:00",
    "hours": 4
  },
  "persons": {
    "adults": 2,
    "kids": 1
  }
}
```
**Ожидаемый результат**: Возвращается статус-код 400 с сообщением об ошибке "Missing Required Fields".

#### Шаг 2:
Отправить POST-запрос на `/api/orders/precalculate` с ID несуществующего объекта:
```json
{
  "object_id": 404,
  "object_date": {
    "booking_date": "2024-06-09",
    "check_in": "20:00:00",
    "hours": 4
  },
  "object_persons": {
    "adults": 2,
    "kids": 1
  }
}
```
**Ожидаемый результат**: Возвращается статус-код 404 с сообщением об ошибке "Object not found".

### Примеры запросов и ответов для негативных кейсов

#### Отсутствуют обязательные поля:
POST `/api/orders/precalculate`
Headers:
```
Authorization: Bearer [токен клиента]
```
**Ожидаемый результат**:
```json
{
    "message": "Missing required fields",
    "status_code": 400
}
```

#### Объект не найден:
POST `/api/orders/precalculate`
Headers:
```
Authorization: Bearer [токен клиента]
```
Body:
```json
{
  "object_id": 404
}
```
**Ожидаемый результат**:
```json
{
    "message": "Domain Error: Не найден объект 78",
    "status_code": 404
}
```

### Постусловия

- Убедиться, что данные о предрасчете корректно отображаются в системе при успешном запросе.
- Проверить, что система корректно обрабатывает отсутствие обязательных полей и несуществующие объекты.

### Замечания/Примечания

- В позитивных тест-кейсах важно проверить, как система обрабатывает различные типы скидок в зависимости от условий пользователя.
- Необходимо убедиться, что логика применения скидок работает корректно и не конфликтует при наличии нескольких активных предложений для одного пользователя.
- Для реализации этих кейсов, система должна иметь доступ к данным о дате рождения пользователя, информации о его лояльности и других активных промоакциях.

- Проверить корректность работы авторизации через токен.
- Убедиться, что система корректно возвращает ошибки при недоступности объекта или отсутствии данных для расчета.


