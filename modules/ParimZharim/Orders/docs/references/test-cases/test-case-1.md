## Создание заказа через API в модуле «Заказы»

### Описание

**Цель**: Тестирование создания заказа через API в модуле «Заказы».

Проверка процесса создания заказа с использованием авторизованного клиента и необходимых данных об объекте, продукте и сервисах.

### Предусловия и необходимые инструменты

- Авторизованный пользователь с профилем клиента.
- Доступ к API по адресу `/api/orders/create`.
- Токен авторизованного клиента.
- Существующий объект с ID, к которому привязано расписание и тариф.
- Существующий продукт с ID.
- Существующий сервис с ID.

### Тестовые данные
- Токен авторизованного клиента: [токен].
- ID существующего объекта
- ID существующего продукта/товара
- ID существующего сервиса/дополнительной услуги

### Позитивные кейсы

#### Шаг 1:
Отправить POST-запрос на `/api/orders/create` с корректными данными:
```json
{
 "object_id": 7,
 "date": {
  "booking_date": "2024-06-09",
  "check_in": "20:00:00",
  "hours": 6
 },
 "persons": {
  "adults": 4,
  "kids": 0
 },
 "products": [
  {
   "product_id": 1,
   "product_quantity": 2
  },
  {
   "product_id": 2,
   "product_quantity": 1
  }
 ],
 "additional_services": [
  {
   "service_id": 1,
   "quantity": 1
  },
  {
   "service_id": 2,
   "quantity": 3
  }
 ],
 "payment_method": "kaspi",
 "notes": "notes"
}
```
**Ожидаемый результат**: Возвращается статус-код 200 и данные с ID созданного заказа:
```json
{
 "order_id": "ID созданного заказа"
}
```

#### Шаг 2:
Проверить в базе данных таблицу `orders` и `orders_order_items`. 
**Ожидаемый результат**: Заказ и его элементы созданы с соответствующими параметрами.

### Негативные кейсы

#### Шаг 1:
Отправить POST-запрос на `/api/orders/create` с пропущенными обязательными полями (object_id, booking_date, check_in, hours, adults).
**Ожидаемый результат**: Возвращается статус-код 400 с сообщением об ошибке "Пропущенные требуемые поля".

#### Шаг 2:
Отправить POST-запрос на `/api/orders/create` с несуществующим токеном или без токена.
**Ожидаемый результат**: Возвращается статус-код 401 с сообщением об ошибке "Нет такого кастомера привязанного".

#### Шаг 3:
Отправить POST-запрос на `/api/orders/create` с занятым слотом, временем в прошлом или без привязанного расписания/тарифа.
**Ожидаемый результат**: Возвращается статус-код 400 с соответствующим сообщением об ошибке.

### Примеры запросов и ответов для негативных кейсов

#### Пропущенные обязательные поля:
```json
{
 "object_id": null,
 "date": {
  "booking_date": null,
  "check_in": null,
  "hours": null
 },
 "persons": {
  "adults": null,
  "kids": 0
 },
 "products": [],
 "additional_services": [],
 "payment_method": "",
 "notes": ""
}
```
**Ожидаемый результат**:
```json
{
    "message": "Missing required fields",
    "status_code": 400
}
```

#### Несуществующий токен:
```json
{
 "object_id": 7,
 "date": {
  "booking_date": "2024-06-09",
  "check_in": "20:00:00",
  "hours": 6
 },
 "persons": {
  "adults": 4,
  "kids": 0
 },
 "products": [
  {
   "product_id": 1,
   "product_quantity": 2
  }
 ],
 "additional_services": [],
 "payment_method": "kaspi",
 "notes": "notes"
}
```
**Ожидаемый результат**: Ошибка 401 с сообщением:
```json
{
    "message": "Unauthenticated."
}
```

#### Занятый слот/время в прошлом/отсутствие расписания или тарифа:
```json
{
 "object_id": 7,
 "date": {
  "booking_date": "2023-01-01",
  "check_in": "20:00:00",
  "hours": 6
 },
 "persons": {
  "adults": 4,
  "kids": 0
 },
 "products": [],
 "additional_services": [],
 "payment_method": "kaspi",
 "notes": "notes"
}
```
**Ожидаемый результат**: Ошибка 500 с сообщением:
```json
{
    "message": "существует заказ # 191 в этот интервал"
}
```
```json
{
    "message": "слот в прошлом"
}
```

### Постусловия

- Убедиться, что заказ успешно создан в базе данных и Админ-панели.
- Убедиться, что заказы и их элементы корректно отображаются в базе данных.

### Замечания/Примечания

- Убедиться, что все обязательные поля заполнены и проверены.
- Проверить корректность работы авторизации через токен.
- Убедиться, что система корректно обрабатывает занятые слоты, время в прошлом и отсутствие расписания/тарифа.
