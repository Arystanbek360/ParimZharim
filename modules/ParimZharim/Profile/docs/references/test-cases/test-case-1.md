## Запрос кода авторизации через API

### Описание

**Цель**: Тестирование функции запроса кода авторизации по номеру телефона через API.

Тестирование включает проверку ограничений по частоте и количеству запросов, а также корректность записи данных в базу данных.

### Предусловия и необходимые инструменты

- Доступ к базе данных (таблица `idm_phone_verification_codes`).
- Инструмент для тестирования API, например, Postman.

### Тестовые данные

- Номер телефона (настоящий): зарегистрированный в России или Казахстане, на который можно получить SMS-сообщение.
- Номер телефона (тестовый): диапазон номеров от +70000001231 до +70000001255

### Шаги

#### Шаг 1: Запрос кода авторизации с настоящим номером телефона
Отправить API-запрос на адрес `/api/idm/request-auth-phone-code` с полем `phone` = "номер телефона зарегистрированный в России или Казахстане".
**Ожидаемый результат**: Код авторизации отправлен, код ответа 204, запись добавлена в таблицу `idm_phone_verification_codes`.

#### Шаг 2: Запрос кода авторизации чаще, чем раз в 25 секунд
Повторить API-запрос с тем же номером телефона раньше, чем через 25 секунд.
**Ожидаемый результат**: Появляется сообщение об ошибке, код ответа 423 (Phone Verification Code Rate Limit Error), код авторизации не отправлен, запись в таблицу не добавляется.

#### Шаг 3: Запрос кода авторизации через 25 секунд
Дождаться 25 секунд и повторить API-запрос с тем же номером телефона.
**Ожидаемый результат**: Код авторизации отправлен, код ответа 204, запись добавлена в таблицу `idm_phone_verification_codes`.

#### Шаг 4: Запрос кода авторизации более 5 раз в день для одного номера
Отправить API-запрос 5 раз в течение дня, дождаться подтверждения, затем отправить 6-й запрос.
**Ожидаемый результат**: Появляется сообщение об ошибке, код ответа 423 (Phone Verification Code Rate Limit Error), код авторизации не отправлен, запись в таблицу не добавляется.

#### Шаг 5: Запрос кода авторизации более 25 раз в день для всех пользователей
Отправить API-запрос 25 раз с разными номерами телефонов из диапазона +70000001231 до +70000001255 (по одному разу для каждого номера), затем отправить 26-й запрос.
**Ожидаемый результат**: Появляется сообщение об ошибке, код ответа 423 (Phone Verification Code Rate Limit Error), код авторизации не отправлен, запись в таблицу не добавляется.

#### Шаг 6: Проверка ограничения для шестого пользователя после 25 запросов
Отправить по 5 запросов с каждым из 5 номеров телефонов (+70000001231 до +70000001235), затем отправить 26-й запрос с нового номера телефона.
**Ожидаемый результат**: Появляется сообщение об ошибке, код ответа 423 (Phone Verification Code Rate Limit Error), код авторизации не отправлен, запись в таблицу не добавляется.

#### Шаг 7: Запрос кода авторизации с тестовым номером телефона
Отправить API-запрос с полем `phone` = "+70000001234".
**Ожидаемый результат**: Код авторизации отправлен, код ответа 204, запись добавлена в таблицу `idm_phone_verification_codes`.

#### Шаг 8: Валидация телефона согласно маске 
Отправить API-запрос на адрес `/api/idm/request-auth-phone-code` с некорректным номером телефона (например, "12345").
**Ожидаемый результат**: Ошибка, код ответа 400 (Invalid Phone Number), код авторизации не отправлен, запись в таблицу не добавляется.

### Постусловия

- Удалить все тестовые данные из таблицы `idm_phone_verification_codes`.
- Восстановить исходные настройки системы, если были изменены.

### Замечания/Примечания

- Время выполнения шага 2 должно быть контролируемо, чтобы избежать некорректных результатов.
- Необходимо проверить логирование событий для анализа возможных ошибок.
